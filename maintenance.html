<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPSU FixIt | Maintenance</title>
    <link rel="stylesheet" href="css/maintenance.css">
    <link rel="stylesheet" type="text/css" href="css/general.css">
    <style>
      .status.ongoing { color: green; }
      .status.completed { color: blue; }
      .status.pending { color: orange; }
    </style>
  </head>
  <body>
  <header>
    <h1><a href="index.html" class="logo-link">BPSU FixIt</a></h1>
    <nav>
      <a href="home.html">Home</a>
      <a href="report.html">Report</a>
      <a href="announce.html">Announcements</a>
      <a href="maintenance.html" class="active">Maintenance</a>
    </nav>
  </header>

  <section class="maintenance-section">
    <h2>Ongoing Maintenance Reports</h2>
    <p>Here are the current maintenance activities within the campus.</p>

    <div class="maintenance-list"></div>
  </section>

  <footer>
    <p>Â© 2025 Bataan Peninsula State University | BPSU FixIt Project</p>
  </footer>

  <script>
  const list = document.querySelector(".maintenance-list");
  const mode = localStorage.getItem("loggedInUser") || "reporter"; 

  function renderReports() {
    let reports = JSON.parse(localStorage.getItem("maintenanceReports")) || [];

    document.querySelectorAll(".maintenance-item.dynamic").forEach(el => el.remove());

    reports.forEach(report => {
      if(mode === "reporter" && report.status.toLowerCase() !== "ongoing") return;

      const a = document.createElement("a");
      a.href = `maintenance-details.html?id=${report.id}`;
      a.classList.add("maintenance-item", report.status.toLowerCase(), "dynamic");

      a.innerHTML = `
        <h3>${report.title} - ${report.location}</h3>
        <p>${report.desc}</p>
        <span class="status ${report.status.toLowerCase()}">Status: ${report.status}</span>
        ${mode === "maintenance" ? '<button class="delete-report">Delete</button><button class="update-status">Update Status</button>' : ''}
      `;
      list.appendChild(a);

      if(mode === "maintenance") {
        // Delete button
        a.querySelector(".delete-report").addEventListener("click", e => {
          e.preventDefault();
          if(confirm("Are you sure you want to delete this report?")){
            reports = reports.filter(r => r.id !== report.id);
            localStorage.setItem("maintenanceReports", JSON.stringify(reports));
            renderReports();
          }
        });

        a.querySelector(".update-status").addEventListener("click", e => {
          e.preventDefault();
          const newStatus = prompt("Enter new status (Pending / Ongoing / Completed):", report.status);
          if(newStatus && ["Pending","Ongoing","Completed"].includes(newStatus)){
            report.status = newStatus;
            localStorage.setItem("maintenanceReports", JSON.stringify(reports));
            renderReports();
          } else alert("Invalid status!");
        });
      }
    });
  }

  renderReports();
  </script>
  </body>
</html>
