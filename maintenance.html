<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- ✅ Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js"></script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPSU FixIt | Maintenance</title>

    <link rel="stylesheet" href="css/maintenance.css" />
    <link rel="stylesheet" type="text/css" href="css/general.css" />

    <style>
      .status.ongoing { color: green; }
      .status.completed { color: blue; }
      .status.pending { color: orange; }

      .maintenance-item {
        display: block;
        border: 1px solid #ccc;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        text-decoration: none;
        color: black;
        background-color: #f9f9f9;
      }

      .maintenance-item h3 {
        margin: 0;
        font-size: 1.3rem;
      }

      .maintenance-item button {
        margin-top: 0.5rem;
        margin-right: 0.5rem;
        padding: 0.4rem 0.8rem;
        border: none;
        border-radius: 6px;
        background-color: #007bff;
        color: white;
        cursor: pointer;
      }

      .maintenance-item button.delete-report {
        background-color: #dc3545;
      }
    </style>
  </head>
  <body>
    <header>
      <h1><a href="index.html" class="logo-link">BPSU FixIt</a></h1>
      <nav>
        <a href="home.html">Home</a>
        <a href="report.html">Report</a>
        <a href="announce.html">Announcements</a>
        <a href="maintenance.html" class="active">Maintenance</a>
      </nav>
    </header>

    <section class="maintenance-section">
      <h2>Ongoing Maintenance Reports</h2>
      <p>Here are the current maintenance activities within the campus.</p>
      <div class="maintenance-list"></div>
    </section>

    <footer>
      <p>© 2025 Bataan Peninsula State University | BPSU FixIt Project</p>
    </footer>

    <script>
      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };

      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      const list = document.querySelector(".maintenance-list");
      const mode = localStorage.getItem("loggedInUser") || "reporter"; 

      function renderReports() {
        db.collection("reports").onSnapshot((snapshot) => {
          list.innerHTML = ""; // Clear old reports

          snapshot.forEach((doc) => {
            const report = doc.data();
            report.id = doc.id;

            // Show only "Ongoing" if user is reporter
            if (mode === "reporter" && report.status.toLowerCase() !== "ongoing") return;

            const a = document.createElement("div");
            a.classList.add("maintenance-item", "dynamic");

            a.innerHTML = `
              <h3>${report.title} - ${report.location}</h3>
              <p>${report.desc}</p>
              <span class="status ${report.status.toLowerCase()}">
                Status: ${report.status}
              </span>
              ${mode === "maintenance" ? `
                <div>
                  <button class="update-status">Update Status</button>
                  <button class="delete-report">Delete</button>
                </div>
              ` : ""}
            `;

            list.appendChild(a);

            if (mode === "maintenance") {
              // Update status
              a.querySelector(".update-status").addEventListener("click", (e) => {
                e.preventDefault();
                const newStatus = prompt(
                  "Enter new status (Pending / Ongoing / Completed):",
                  report.status
                );
                if (newStatus && ["Pending", "Ongoing", "Completed"].includes(newStatus)) {
                  db.collection("reports").doc(report.id).update({ status: newStatus });
                } else {
                  alert("Invalid status!");
                }
              });

              a.querySelector(".delete-report").addEventListener("click", (e) => {
                e.preventDefault();
                if (confirm("Are you sure you want to delete this report?")) {
                  db.collection("reports").doc(report.id).delete();
                }
              });
            }
          });
        });
      }

      renderReports();
    </script>
  </body>
</html>
