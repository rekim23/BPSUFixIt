<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPSU FixIt | Report</title>
    <link rel="stylesheet" type="text/css" href="css/report.css">
    <link rel="stylesheet" type="text/css" href="css/general.css">
  
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";
  
      const firebaseConfig = {
        apiKey: "AIzaSyBROvnWxmMo1tb_Ox6s1hQeMnGJszErpFw",
        authDomain: "bpsufixit.firebaseapp.com",
        projectId: "bpsufixit",
        storageBucket: "bpsufixit.appspot.com",
        messagingSenderId: "338879407401",
        appId: "1:338879407401:web:a298953b6be0f8cb1ac338",
        measurementId: "G-RX09SFB4ZH"
      };
  
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
  
      window.submitReport = async function(reportData){
        try {
          await addDoc(collection(db, "reports"), reportData);
          return true;
        } catch (err) {
          console.error("Error submitting report:", err);
          return false;
        }
      }
    </script>
  </head>
  
  <body>
  <header>
    <h1><a href="index.html" class="logo-link">BPSU FixIt</a></h1>
    <nav>
      <a href="home.html">Home</a>
      <a href="report.html" class="active">Report</a>
      <a href="announce.html">Announcements</a>
      <a href="maintenance.html">Maintenance</a>
    </nav>
  </header>
  
  <section class="report-container">
    <h2>Report a Facility Problem</h2>
    <p>Please fill out the form below to report any damaged or malfunctioning school facility.</p>
  
    <form id="reportForm">
      <label for="name">Full Name:</label>
      <input type="text" id="name" required />
  
      <label for="email">Email:</label>
      <input type="email" id="email" required />
  
      <label for="location">Location (Building/Room):</label>
      <input type="text" id="location" required />
  
      <label for="issue">Describe the Issue:</label>
      <textarea id="issue" rows="4" required></textarea>
  
      <label for="photo">Upload a Photo (optional):</label>
      <input type="file" id="photo" accept="image/*" multiple />
  
      <button type="submit" class="btn">Submit Report</button>
    </form>
  
    <div id="successMessage" class="hidden">
      <h3>‚úÖ Report Submitted Successfully!</h3>
      <p>Thank you for helping keep BPSU facilities in good condition.</p>
    </div>
  </section>
  
  <footer>
    <p>¬© 2025 Bataan Peninsula State University | BPSU FixIt Project</p>
  </footer>
  
  <script type="module">
    const form = document.getElementById("reportForm");
    const message = document.getElementById("successMessage");
  
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
  
      const photoInput = document.getElementById("photo");
      const images = [];
  
      if(photoInput.files.length > 0){
        for(let i=0; i<photoInput.files.length; i++){
          const file = photoInput.files[i];
          const reader = new FileReader();
          const p = new Promise((resolve) => {
            reader.onload = function(event){
              images.push(event.target.result);
              resolve();
            }
          });
          reader.readAsDataURL(file);
          await p;
        }
      }
  
      const reportData = {
        title: `üõ† ${document.getElementById("issue").value.substring(0, 30)}...`,
        location: document.getElementById("location").value,
        status: "Pending",
        desc: document.getElementById("issue").value,
        images: images,
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        timestamp: new Date().toISOString()
      };
  
      const success = await window.submitReport(reportData);
      if(success){
        message.classList.remove("hidden");
        form.reset();
      } else {
        alert("‚ùå Error submitting report. Please try again.");
      }
    });
  </script>
  </body>
</html>

