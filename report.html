<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPSU FixIt | Report</title>
    <link rel="stylesheet" type="text/css" href="css/report.css">
    <link rel="stylesheet" type="text/css" href="css/general.css">

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      window.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("reportForm");
        const message = document.getElementById("successMessage");

        form.addEventListener("submit", async (e) => {
          e.preventDefault();

          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const location = document.getElementById("location").value;
          const issue = document.getElementById("issue").value;
          const photoInput = document.getElementById("photo");

          const reportData = {
            name,
            email,
            location,
            issue,
            title: `üõ† ${issue.substring(0, 30)}...`,
            desc: issue,
            status: "Pending",
            timestamp: new Date().toISOString(),
            images: []
          };

          const files = photoInput.files;
          if (files.length > 0) {
            const readPromises = Array.from(files).map(file => {
              return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (event) => resolve(event.target.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
              });
            });
            reportData.images = await Promise.all(readPromises);
          }

          try {
            await addDoc(collection(db, "reports"), reportData);
            form.reset();
            message.classList.remove("hidden");
          } catch (error) {
            console.error("Error adding report:", error);
            alert("‚ùå Error submitting report. Check your Firebase config or connection.");
          }
        });
      });
    </script>

    <style>
      .hidden {
        display: none;
      }
    </style>
  </head>

  <body>
    <header>
      <h1><a href="index.html" class="logo-link">BPSU FixIt</a></h1>
      <nav>
        <a href="home.html">Home</a>
        <a href="report.html" class="active">Report</a>
        <a href="announce.html">Announcements</a>
        <a href="maintenance.html">Maintenance</a>
      </nav>
    </header>

    <section class="report-container">
      <h2>Report a Facility Problem</h2>
      <p>Please fill out the form below to report any damaged or malfunctioning school facility.</p>

      <form id="reportForm">
        <label for="name">Full Name:</label>
        <input type="text" id="name" required />

        <label for="email">Email:</label>
        <input type="email" id="email" required />

        <label for="location">Location (Building/Room):</label>
        <input type="text" id="location" required />

        <label for="issue">Describe the Issue:</label>
        <textarea id="issue" rows="4" required></textarea>

        <label for="photo">Upload a Photo (optional):</label>
        <input type="file" id="photo" accept="image/*" multiple />

        <button type="submit" class="btn">Submit Report</button>
      </form>

      <div id="successMessage" class="hidden">
        <h3>‚úÖ Report Submitted Successfully!</h3>
        <p>Thank you for helping keep BPSU facilities in good condition.</p>
      </div>
    </section>

    <footer>
      <p>¬© 2025 Bataan Peninsula State University | BPSU FixIt Project</p>
    </footer>
  </body>
</html>

